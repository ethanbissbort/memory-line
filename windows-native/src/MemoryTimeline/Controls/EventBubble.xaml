<UserControl
    x:Class="MemoryTimeline.Controls.EventBubble"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    d:DesignHeight="40"
    d:DesignWidth="30">

    <Grid x:Name="RootGrid"
          PointerEntered="RootGrid_PointerEntered"
          PointerExited="RootGrid_PointerExited"
          Width="30"
          Height="40">

        <!-- Map pin shape -->
        <Canvas Width="30" Height="40">
            <!-- Pin body (teardrop shape) -->
            <Path x:Name="PinPath"
                  Fill="{x:Bind CategoryBrush, Mode=OneWay}"
                  Stroke="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                  StrokeThickness="1"
                  Data="M15,40 C15,40 0,22 0,14 C0,6.27 6.72,0 15,0 C23.28,0 30,6.27 30,14 C30,22 15,40 15,40 Z">
                <Path.Shadow>
                    <ThemeShadow/>
                </Path.Shadow>
            </Path>

            <!-- Inner circle (white hole) -->
            <Ellipse Canvas.Left="7"
                     Canvas.Top="6"
                     Width="16"
                     Height="16"
                     Fill="White"
                     Opacity="0.9"/>

            <!-- Category icon in center -->
            <FontIcon x:Name="CategoryIcon"
                     Canvas.Left="7"
                     Canvas.Top="6"
                     Width="16"
                     Height="16"
                     Glyph="{x:Bind CategoryGlyph, Mode=OneWay}"
                     FontSize="10"
                     Foreground="{x:Bind CategoryBrush, Mode=OneWay}"
                     HorizontalAlignment="Center"
                     VerticalAlignment="Center"/>
        </Canvas>

        <!-- Tooltip with event details -->
        <ToolTipService.ToolTip>
            <ToolTip>
                <StackPanel Spacing="4" MaxWidth="300">
                    <TextBlock Text="{x:Bind Event.Title, Mode=OneWay}"
                              FontWeight="SemiBold"
                              FontSize="14"
                              TextWrapping="Wrap"/>

                    <TextBlock FontSize="12" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}">
                        <Run Text="{x:Bind FormatDate(Event.StartDate), Mode=OneWay}"/>
                        <Run x:Name="EndDateRun"
                             Text="{x:Bind FormatEndDate(Event.EndDate), Mode=OneWay}"/>
                    </TextBlock>

                    <TextBlock Text="{x:Bind Event.Description, Mode=OneWay}"
                              FontSize="12"
                              TextWrapping="Wrap"
                              MaxLines="5"
                              TextTrimming="CharacterEllipsis"
                              Visibility="{x:Bind Event.Description, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}"/>

                    <TextBlock Text="{x:Bind Event.Category, Mode=OneWay}"
                              FontSize="11"
                              Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                              FontStyle="Italic"/>
                </StackPanel>
            </ToolTip>
        </ToolTipService.ToolTip>
    </Grid>
</UserControl>
